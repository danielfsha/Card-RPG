# Dead Man's Draw - ZK Card Game Design

## Game Overview

A pirate-themed push-your-luck card game where players draw cards trying to collect different suits without busting (drawing duplicate suits). Uses Zero-Knowledge proofs to ensure fairness without revealing deck order.

## Card Deck

**Total: 40 Cards**
- 4 Suits Ã— 10 Cards each
- Suits: Swords (âš”ï¸), Coins (ğŸª™), Cups (ğŸ†), Wands (ğŸ”®)
- Values: 1-10 in each suit

## Game Rules

### Setup
1. Both players commit their deck Merkle roots
2. Commit-reveal for shared randomness
3. Deck is deterministically shuffled using shared seed
4. Each player starts with 0 points

### Turn Flow
1. **Draw Phase**: Active player draws a card
2. **Decision**: Continue drawing or stop
3. **Bust Check**: If duplicate suit drawn â†’ BUST (lose all cards this turn)
4. **Bank**: If stop before bust â†’ add all drawn cards' values to score
5. **Switch**: Turn passes to opponent

### Win Condition
- First player to reach 60 points wins
- OR opponent busts 3 times

## ZK Proof System

### What We Prove

#### 1. Deck Shuffle Proof
**Public Inputs:**
- `player1_seed_hash`: SHA256(player1_seed)
- `player2_seed_hash`: SHA256(player2_seed)
- `deck_commitment`: Merkle root of shuffled deck

**Private Inputs:**
- `player1_seed`: Player 1's secret
- `player2_seed`: Player 2's secret
- `original_deck[40]`: Standard deck order
- `shuffle_indices[40]`: Permutation indices

**Proves:**
1. Seeds match committed hashes
2. Shuffle is deterministic from combined seed
3. Deck commitment is valid Merkle root
4. All 40 cards present (no duplicates/missing)

#### 2. Draw Proof
**Public Inputs:**
- `deck_root`: Merkle root of player's deck
- `current_suits_mask`: Bitmask of suits already drawn this turn
- `card_index`: Position in deck
- `is_bust`: 1 if bust, 0 if valid

**Private Inputs:**
- `card_value`: The card being drawn
- `merkle_path[6]`: Merkle proof siblings
- `merkle_indices[6]`: Path directions

**Proves:**
1. Card exists at index in committed deck
2. Bust detection is correct (suit already in mask)
3. New suits mask computed correctly

#### 3. Game State Proof
**Public Inputs:**
- `initial_deck_root`: Starting deck commitment
- `final_score_p1`: Player 1's final score
- `final_score_p2`: Player 2's final score
- `winner`: 0 or 1
- `num_turns`: Total turns played

**Private Inputs:**
- `full_deck[40]`: Complete deck
- `draw_sequence[num_turns]`: All draws made
- `merkle_proofs[num_turns]`: Proofs for each draw

**Proves:**
1. All draws were valid from committed deck
2. Bust detection correct for each turn
3. Score calculation correct
4. Winner determination correct

## Game Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GAME START                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 1: DECK COMMITMENT                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Player 1   â”‚              â”‚   Player 2   â”‚            â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ Generate     â”‚              â”‚ Generate     â”‚            â”‚
â”‚  â”‚ Deck Order   â”‚              â”‚ Deck Order   â”‚            â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ Compute      â”‚              â”‚ Compute      â”‚            â”‚
â”‚  â”‚ Merkle Root  â”‚              â”‚ Merkle Root  â”‚            â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ Submit Root  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Submit Root  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 2: COMMIT-REVEAL                                      â”‚
â”‚                                                              â”‚
â”‚  Step 1: COMMIT                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Player 1   â”‚              â”‚   Player 2   â”‚            â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ seed1 = rand()â”‚             â”‚ seed2 = rand()â”‚           â”‚
â”‚  â”‚ hash1 = SHA256(seed1)       â”‚ hash2 = SHA256(seed2)     â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ Submit hash1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Submit hash2 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â”‚  Step 2: REVEAL                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Reveal seed1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Reveal seed2 â”‚            â”‚
â”‚  â”‚              â”‚              â”‚              â”‚            â”‚
â”‚  â”‚ Verify:      â”‚              â”‚ Verify:      â”‚            â”‚
â”‚  â”‚ SHA256(seed1)â”‚              â”‚ SHA256(seed2)â”‚            â”‚
â”‚  â”‚ == hash1     â”‚              â”‚ == hash2     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â”‚  shared_seed = Poseidon(seed1, seed2)                       â”‚
â”‚  starting_player = shared_seed % 2                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 3: GAMEPLAY LOOP                                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  TURN START                                         â”‚    â”‚
â”‚  â”‚  - Active Player                                    â”‚    â”‚
â”‚  â”‚  - Current Score: P1=X, P2=Y                        â”‚    â”‚
â”‚  â”‚  - Turn Cards: []                                   â”‚    â”‚
â”‚  â”‚  - Suits Mask: 0b0000                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                              â”‚
â”‚               â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DRAW CARD                                          â”‚    â”‚
â”‚  â”‚  1. Select next card from deck                      â”‚    â”‚
â”‚  â”‚  2. Generate ZK proof:                              â”‚    â”‚
â”‚  â”‚     - Card in deck (Merkle proof)                   â”‚    â”‚
â”‚  â”‚     - Bust check (suit mask)                        â”‚    â”‚
â”‚  â”‚  3. Reveal card value                               â”‚    â”‚
â”‚  â”‚  4. Update suits mask                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                              â”‚
â”‚               â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  BUST CHECK                                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  Is suit already in mask?                           â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  YES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         NO                         â”‚    â”‚
â”‚  â”‚                â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚                â–¼          â–¼                          â”‚    â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚           â”‚  BUST  â”‚  â”‚ SAFE   â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚        â”‚  â”‚        â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Lose   â”‚  â”‚ Add to â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ All    â”‚  â”‚ Turn   â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Cards  â”‚  â”‚ Cards  â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚        â”‚  â”‚        â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ End    â”‚  â”‚ Update â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Turn   â”‚  â”‚ Mask   â”‚                    â”‚    â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚                â”‚          â–¼                          â”‚    â”‚
â”‚  â”‚                â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚                â”‚     â”‚  DECISION  â”‚                 â”‚    â”‚
â”‚  â”‚                â”‚     â”‚            â”‚                 â”‚    â”‚
â”‚  â”‚                â”‚     â”‚ Draw More? â”‚                 â”‚    â”‚
â”‚  â”‚                â”‚     â”‚            â”‚                 â”‚    â”‚
â”‚  â”‚                â”‚     â”‚ YES    NO  â”‚                 â”‚    â”‚
â”‚  â”‚                â”‚     â””â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                â”‚        â”‚    â”‚                      â”‚    â”‚
â”‚  â”‚                â”‚        â”‚    â–¼                      â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”‚  BANK    â”‚            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”‚          â”‚            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”‚ Add Turn â”‚            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”‚ Cards to â”‚            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â”‚ Score    â”‚            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â”‚                â”‚        â”‚       â”‚                  â”‚    â”‚
â”‚  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                         â”‚                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                               â”‚
â”‚                             â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  WIN CHECK                                          â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  P1 >= 60 OR P2 >= 60?                              â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  YES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         NO                         â”‚    â”‚
â”‚  â”‚                â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚                â–¼          â–¼                          â”‚    â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚           â”‚  WIN   â”‚  â”‚ SWITCH â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚        â”‚  â”‚ PLAYER â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Submit â”‚  â”‚        â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Final  â”‚  â”‚ Next   â”‚                    â”‚    â”‚
â”‚  â”‚           â”‚ Proof  â”‚  â”‚ Turn   â”‚                    â”‚    â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚                â”‚                             â”‚       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚                   â”‚                                     â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 4: SETTLEMENT                                         â”‚
â”‚                                                              â”‚
â”‚  1. Generate final game proof                                â”‚
â”‚  2. Submit proof to contract                                 â”‚
â”‚  3. Contract verifies:                                       â”‚
â”‚     - All draws valid                                        â”‚
â”‚     - Score calculation correct                              â”‚
â”‚     - Winner determination correct                           â”‚
â”‚  4. Call Game Hub end_game()                                 â”‚
â”‚  5. Emit winner event                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sequence Diagram

```
Player1          Frontend         Contract         ZKCircuit        Player2
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 Create Game                                       â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Generate Deck  â”‚                â”‚                â”‚                â”‚
  â”‚  [1,2,3,...,40] â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Compute Merkle â”‚                â”‚                â”‚                â”‚
  â”‚  Root           â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Submit Rootâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Submit Root   â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚  start_game()  â”‚                â”‚
  â”‚                 â”‚                â”‚  (both roots)  â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 COMMIT PHASE                                      â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  seed1 = rand() â”‚                â”‚                â”‚                â”‚
  â”‚  hash1 = SHA256(seed1)           â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  commit(hash1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  seed2 = rand()â”‚
  â”‚                 â”‚                â”‚                â”‚  hash2 = SHA256â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€commit(hash2)â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 REVEAL PHASE                                      â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  reveal(seed1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚  Verify:       â”‚                â”‚
  â”‚                 â”‚                â”‚  SHA256(seed1) â”‚                â”‚
  â”‚                 â”‚                â”‚  == hash1      â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€reveal(seed2)â”‚
  â”‚                 â”‚                â”‚  Verify:       â”‚                â”‚
  â”‚                 â”‚                â”‚  SHA256(seed2) â”‚                â”‚
  â”‚                 â”‚                â”‚  == hash2      â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚  shared_seed = â”‚                â”‚
  â”‚                 â”‚                â”‚  Poseidon(s1,s2)                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚  active_player â”‚                â”‚
  â”‚                 â”‚                â”‚  = seed % 2    â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 GAMEPLAY (Turn 1)                                 â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  [P1's Turn]    â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Draw card #5   â”‚                â”‚                â”‚                â”‚
  â”‚  Value: 7â™       â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Generate Proof:â”‚                â”‚                â”‚                â”‚
  â”‚  - Card at idx 5â”‚                â”‚                â”‚                â”‚
  â”‚  - Merkle proof â”‚                â”‚                â”‚                â”‚
  â”‚  - Suits mask=0 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Proveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Verify        â”‚
  â”‚                 â”‚                â”‚                â”‚  - Card in deckâ”‚
  â”‚                 â”‚                â”‚                â”‚  - No bust     â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  - New mask=1  â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  draw_phase()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚  (proof, mask=1)â”‚                â”‚  Verify proof  â”‚                â”‚
  â”‚                 â”‚                â”‚  Update state  â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Decision: Draw More              â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Draw card #12  â”‚                â”‚                â”‚                â”‚
  â”‚  Value: 3ğŸª™     â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Generate Proof â”‚                â”‚                â”‚                â”‚
  â”‚  Proveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Verify        â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  New mask=3    â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  draw_phase()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚  (proof, mask=3)â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Decision: BANK â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  bank_cards()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚  (cards: [7â™ ,3ğŸª™])                â”‚  Add to score â”‚                â”‚
  â”‚                 â”‚                â”‚  P1: 0â†’10      â”‚                â”‚
  â”‚                 â”‚                â”‚  Switch player â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                 GAMEPLAY (Turn 2)                                 â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  [P2's Turn]   â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Draw card #3  â”‚
  â”‚                 â”‚                â”‚                â”‚  Value: 9â™      â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Generate Proofâ”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Prove        â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€draw_phase() â”‚
  â”‚                 â”‚                â”‚                â”‚  (proof)       â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Draw card #8  â”‚
  â”‚                 â”‚                â”‚                â”‚  Value: 5â™      â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  BUST! (â™ dup) â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Generate Proofâ”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Prove        â”‚
  â”‚                 â”‚                â”‚                â”‚  (is_bust=1)   â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€draw_phase() â”‚
  â”‚                 â”‚                â”‚                â”‚  (proof, bust) â”‚
  â”‚                 â”‚                â”‚  Verify bust   â”‚                â”‚
  â”‚                 â”‚                â”‚  P2 loses cardsâ”‚                â”‚
  â”‚                 â”‚                â”‚  Switch player â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  ... Continue gameplay until win condition ...                    â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 SETTLEMENT                                        â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  P1 Score: 62   â”‚                â”‚                â”‚                â”‚
  â”‚  P2 Score: 45   â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Generate Final â”‚                â”‚                â”‚                â”‚
  â”‚  Game Proof:    â”‚                â”‚                â”‚                â”‚
  â”‚  - All draws    â”‚                â”‚                â”‚                â”‚
  â”‚  - All scores   â”‚                â”‚                â”‚                â”‚
  â”‚  - Winner: P1   â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  Proveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚  Verify full   â”‚
  â”‚                 â”‚                â”‚                â”‚  game state    â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚  settle_game()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚  (final_proof)  â”‚                â”‚  Verify proof  â”‚                â”‚
  â”‚                 â”‚                â”‚  Call GameHub  â”‚                â”‚
  â”‚                 â”‚                â”‚  end_game(P1)  â”‚                â”‚
  â”‚                 â”‚                â”‚  Emit winner   â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
  â”‚  Winner: Player1â”‚                â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚                â”‚
```

## State Machine Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CREATED   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ start_game()
                           â”‚ (both deck roots)
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   COMMIT    â”‚
                    â”‚             â”‚
                    â”‚ Waiting for â”‚
                    â”‚ both seed   â”‚
                    â”‚ commitments â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Both committed
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   REVEAL    â”‚
                    â”‚             â”‚
                    â”‚ Waiting for â”‚
                    â”‚ both seed   â”‚
                    â”‚ reveals     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Both revealed
                           â”‚ Derive shared_seed
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€>â”‚   PLAYING   â”‚<â”€â”€â”€â”€â”
              â”‚     â”‚             â”‚     â”‚
              â”‚     â”‚ Active      â”‚     â”‚
              â”‚     â”‚ Player's    â”‚     â”‚
              â”‚     â”‚ Turn        â”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
              â”‚            â”‚            â”‚
              â”‚            â”‚ draw_phase()
              â”‚            â”‚ (ZK proof) â”‚
              â”‚            â–¼            â”‚
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
              â”‚     â”‚  DRAWING    â”‚     â”‚
              â”‚     â”‚             â”‚     â”‚
              â”‚     â”‚ Card drawn  â”‚     â”‚
              â”‚     â”‚ Bust check  â”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
              â”‚            â”‚            â”‚
              â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
              â”‚      â”‚           â”‚      â”‚
              â”‚   BUST         SAFE     â”‚
              â”‚      â”‚           â”‚      â”‚
              â”‚      â”‚           â–¼      â”‚
              â”‚      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      â”‚    â”‚  DECISION   â”‚
              â”‚      â”‚    â”‚             â”‚
              â”‚      â”‚    â”‚ Draw more   â”‚
              â”‚      â”‚    â”‚ or Bank?    â”‚
              â”‚      â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚      â”‚           â”‚      â”‚
              â”‚      â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”â”‚
              â”‚      â”‚     â”‚           â”‚â”‚
              â”‚      â”‚   DRAW        BANK
              â”‚      â”‚     â”‚           â”‚â”‚
              â”‚      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
              â”‚      â”‚                  â”‚
              â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚             â”‚
              â”‚             â”‚ end_turn()
              â”‚             â”‚ Switch player
              â”‚             â”‚
              â”‚             â–¼
              â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      â”‚  WIN CHECK  â”‚
              â”‚      â”‚             â”‚
              â”‚      â”‚ Score >= 60?â”‚
              â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚             â”‚
              â”‚       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
              â”‚       â”‚           â”‚
              â”‚      NO          YES
              â”‚       â”‚           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  FINISHED   â”‚
                           â”‚             â”‚
                           â”‚ Submit      â”‚
                           â”‚ final proof â”‚
                           â”‚ to contract â”‚
                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ settle_game()
                                  â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  SETTLED    â”‚
                           â”‚             â”‚
                           â”‚ Winner      â”‚
                           â”‚ recorded    â”‚
                           â”‚ on-chain    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Structures

### Card
```rust
pub struct Card {
    pub suit: u8,    // 0-3 (Swords, Coins, Cups, Wands)
    pub value: u8,   // 1-10
}

// Encoding: card_id = suit * 10 + (value - 1)
// Example: 7 of Swords = 0 * 10 + 6 = 6
// Example: 3 of Coins = 1 * 10 + 2 = 12
```

### GameState
```rust
pub struct GameState {
    pub session_id: u32,
    pub player1: Address,
    pub player2: Address,
    pub p1_deck_root: Bytes,
    pub p2_deck_root: Bytes,
    pub p1_commit: Option<Bytes>,
    pub p2_commit: Option<Bytes>,
    pub p1_revealed: bool,
    pub p2_revealed: bool,
    pub shared_seed: Bytes,
    pub p1_score: u32,
    pub p2_score: u32,
    pub p1_busts: u8,
    pub p2_busts: u8,
    pub active_player: Address,
    pub current_turn_cards: Vec<u8>,
    pub current_suits_mask: u8,  // 4 bits for 4 suits
    pub phase: Phase,
    pub turn_number: u32,
}
```

### Phase
```rust
pub enum Phase {
    Created,
    Commit,
    Reveal,
    Playing,
    Drawing,
    Finished,
    Settled,
}
```

## Circuit Specifications

### 1. Deck Shuffle Circuit
**File**: `circuits/src/deck_shuffle.circom`
**Constraints**: ~10,000
**Purpose**: Prove deterministic shuffle from seeds

### 2. Draw Validation Circuit
**File**: `circuits/src/draw_validation.circom`
**Constraints**: ~5,000
**Purpose**: Prove single card draw is valid

### 3. Game Simulation Circuit
**File**: `circuits/src/game_simulation.circom`
**Constraints**: ~50,000
**Purpose**: Prove entire game outcome

## Security Properties

1. **Deck Privacy**: Opponent never learns deck order
2. **Fairness**: Neither player can manipulate shuffle
3. **Verifiability**: All moves provably valid
4. **Determinism**: Same seeds â†’ same game outcome
5. **No Cheating**: Invalid moves mathematically impossible

## Implementation Checklist

- [ ] Implement deck shuffle circuit
- [ ] Implement draw validation circuit
- [ ] Implement game simulation circuit
- [ ] Build circuits in WSL
- [ ] Generate proving/verification keys
- [ ] Implement contract with proper logic
- [ ] Add comprehensive tests
- [ ] Create frontend integration
- [ ] Test end-to-end flow
- [ ] Deploy to testnet
